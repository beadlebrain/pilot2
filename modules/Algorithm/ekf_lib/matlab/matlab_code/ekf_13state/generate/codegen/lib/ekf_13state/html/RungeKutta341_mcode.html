<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="100,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">X</span>=RungeKutta(<span class="mxinfo" id="T2:U2"><span class="mxinfo" id="T2:U3"><span class="var type1" id="S2T2U6">X</span></span></span>,<span class="var type1" id="S3T1U7">U</span>,<span class="var type1" id="S4T3U8">dT</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="100,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%2nd order runge-kutta implement</span></span></span>
<span class="srcline"><span class="lineno"><a href="100,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T2:U7"><span class="var type1" id="S5T2U11">Xlast</span>=<span class="var type1" id="S2T2U12">X</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T8:U10"><span class="var type1" id="S6T8U15">k1</span>=<span class="mxinfo" id="T8:U12"><span class="fcn" id="F1N10:B17">f</span>(<span class="var type1" id="S2T2U18">X</span>,<span class="var type1" id="S3T1U19">U</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T2:U15"><span class="var type1" id="S2T2U22">X</span>=<span class="mxinfo" id="T2:U17"><span class="var type1" id="S5T2U24">Xlast</span>+<span class="mxinfo" id="T2:U19"><span class="mxinfo" id="T3:U20">0.5*<span class="var type1" id="S4T3U28">dT</span></span>*<span class="var type1" id="S6T8U29">k1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T8:U23"><span class="var type1" id="S8T8U32">k2</span>=<span class="mxinfo" id="T8:U25"><span class="fcn" id="F1N10:B34">f</span>(<span class="mxinfo" id="T2:U26"><span class="var type1" id="S2T2U36">X</span>+<span class="mxinfo" id="T2:U28"><span class="mxinfo" id="T3:U29">0.5*<span class="var type1" id="S4T3U40">dT</span></span>*<span class="var type1" id="S6T8U41">k1</span></span></span>,<span class="var type1" id="S3T1U42">U</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S2T2U45">X</span>=<span class="mxinfo" id="T2:U35"><span class="var type1" id="S5T2U47">Xlast</span>+<span class="mxinfo" id="T2:U37"><span class="mxinfo" id="T3:U38">0.5*<span class="var type1" id="S4T3U51">dT</span></span>*<span class="var type1" id="S8T8U52">k2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T8:U41"><span class="var type1" id="S9T8U55">k3</span>=<span class="mxinfo" id="T8:U43"><span class="fcn" id="F1N10:B57">f</span>(<span class="mxinfo" id="T2:U44"><span class="var type1" id="S2T2U59">X</span>+<span class="mxinfo" id="T2:U46"><span class="mxinfo" id="T3:U47">0.5*<span class="var type1" id="S4T3U63">dT</span></span>*<span class="var type1" id="S8T8U64">k2</span></span></span>,<span class="var type1" id="S3T1U65">U</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T2:U51"><span class="var type1" id="S2T2U68">X</span>=<span class="mxinfo" id="T2:U53"><span class="var type1" id="S5T2U70">Xlast</span>+<span class="mxinfo" id="T2:U55"><span class="mxinfo" id="T3:U56">0.5*<span class="var type1" id="S4T3U74">dT</span></span>*<span class="var type1" id="S9T8U75">k3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T8:U59"><span class="var type1" id="S10T8U78">k4</span>=<span class="mxinfo" id="T8:U61"><span class="fcn" id="F1N10:B80">f</span>(<span class="mxinfo" id="T2:U62"><span class="var type1" id="S2T2U82">X</span>+<span class="mxinfo" id="T2:U64"><span class="var type1" id="S4T3U84">dT</span>*<span class="var type1" id="S9T8U85">k3</span></span></span>,<span class="var type1" id="S3T1U86">U</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T2:U68"><span class="var type1" id="S2T2U89">X</span>=<span class="mxinfo" id="T2:U70"><span class="var type1" id="S5T2U91">Xlast</span>+<span class="mxinfo" id="T2:U72"><span class="mxinfo" id="T2:U73"><span class="var type1" id="S4T3U94">dT</span>*(<span class="mxinfo" id="T8:U75"><span class="mxinfo" id="T8:U76"><span class="mxinfo" id="T8:U77"><span class="var type1" id="S6T8U99">k1</span>+<span class="mxinfo" id="T8:U79"><span class="mxinfo" id="T4:U80">2</span>*<span class="var type1" id="S8T8U102">k2</span></span></span>+<span class="mxinfo" id="T8:U82"><span class="mxinfo" id="T4:U83">2</span>*<span class="var type1" id="S9T8U105">k3</span></span></span>+<span class="var type1" id="S10T8U106">k4</span></span>)</span>/<span class="mxinfo" id="T4:U86">6</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,12" id="srcline12">12</a></span><span class="line"><span class="comment">% X=Xlast+dT*f(X,U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="100,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T2:U87"><span class="var type1" id="S2T2U110">X</span>=<span class="mxinfo" id="T2:U89"><span class="fcn" id="F323N14:B112">normlise_quaternion</span>(<span class="var type1" id="S2T2U113">X</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="100,14" id="srcline14">14</a></span><span class="line"></span></span>
</pre>
